<script>
  const form = document.getElementById('leadForm');
  const btn = document.getElementById('btnSend');
  const success = document.getElementById('success');
  const whatsFloat = document.getElementById('whatsFloat');
  const whatsTextLink = document.getElementById('whatsTextLink');

  function buildWhatsUrlFromForm() {
    const nome = (form.nome?.value || '').trim();
    const whatsapp = (form.whatsapp?.value || '').trim();
    const cidade = (form.cidade?.value || '').trim();
    const negocio = (form.negocio?.value || '').trim();
    const servico = (form.servico?.value || '').trim();
    const insta = (form.instagram?.value || '').trim();

    const msg =
      `Oi PL Digital! Quero gestão de páginas e marketing.\n\n` +
      `Nome: ${nome}\n` +
      `WhatsApp: ${whatsapp}\n` +
      `Cidade: ${cidade}\n` +
      `Negócio: ${negocio}\n` +
      `Interesse: ${servico}\n` +
      (insta ? `Instagram: ${insta}\n` : '');

    return `https://wa.me/5531998064556?text=${encodeURIComponent(msg)}`;
  }

  function syncWhatsLinks() {
    const url = buildWhatsUrlFromForm();
    whatsFloat.href = url;
    whatsTextLink.href = url;
  }

  // Atualiza o link enquanto o cliente digita
  form.addEventListener('input', syncWhatsLinks);
  syncWhatsLinks();

  form.addEventListener('submit', (e) => {
    e.preventDefault();

    if (!form.checkValidity()) {
      form.classList.add('was-validated');
      return;
    }

    // ✅ GUARDA o link com os dados ANTES de limpar qualquer coisa
    const urlFinal = buildWhatsUrlFromForm();

    // Feedback
    btn.disabled = true;
    const old = btn.innerText;
    btn.innerText = 'Enviando...';

    setTimeout(() => {
      success.classList.remove('d-none');
      btn.disabled = false;
      btn.innerText = old;

      // ✅ Abre o WhatsApp imediatamente com tudo preenchido
      window.open(urlFinal, '_blank');

      // ✅ IMPORTANTE: NÃO limpar automaticamente (evita apagar dados)
      // Se quiser limpar depois, descomente as 3 linhas abaixo:
      // form.reset();
      // form.classList.remove('was-validated');
      // syncWhatsLinks();
    }, 400);
  });
</script>
